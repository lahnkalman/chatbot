<!doctype html>
<html lang="he">
<head>
    <meta charset="utf-8">
    <title>×¡×•×›×Ÿ ×”×§×¦××” ×œ×™××•×“×™</title>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1100px;
            margin: auto;
            padding: 20px;
        }

        form {
            margin-bottom: 30px;
        }

        .charts-row {
            display: flex;
            gap: 40px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 20px;
        }

        .chart-box {
            width: 280px;
            text-align: center;
        }

        h3 {
            margin-top: 30px;
        }

        button {
            margin-top: 10px;
            padding: 6px 12px;
        }

        hr {
            margin: 30px 0;
        }
    </style>
</head>

<body>

<h2>ğŸ¤– ×¡×•×›×Ÿ ×”×§×¦××” ×œ×™××•×“×™ (×›×¡×£ ××“×•××”)</h2>

<a href="/history">ğŸ“ ×”×™×¡×˜×•×¨×™×”</a>
<hr>

<form method="post">
    ×¡×›×•× (×©"×—):<br>
    <input name="amount" required><br><br>

    ××•×¤×§ ×–××Ÿ (×©× ×™×):<br>
    <input name="years" required><br><br>

    ×¨××ª ×¡×™×›×•×Ÿ:<br>
    <select name="risk">
        <option>× ××•×š</option>
        <option>×‘×™× ×•× ×™</option>
        <option>×’×‘×•×”</option>
    </select><br><br>

    × ×–×™×œ×•×ª:<br>
    <select name="liquidity">
        <option>×’×‘×•×”×”</option>
        <option>×‘×™× ×•× ×™×ª</option>
        <option>× ××•×›×”</option>
    </select><br><br>

    ×™×¢×“:<br>
    <select name="goal">
        <option>×©××™×¨×” ×¢×œ ×¢×¨×š (×©××¨× ×™)</option>
        <option>××™×–×•×Ÿ (×‘×™× ×™×™×)</option>
        <option>×¦××™×—×” (××’×¨×¡×™×‘×™)</option>
    </select><br><br>

    × ×™×¡×™×•×Ÿ:<br>
    <select name="experience">
        <option>××ª×—×™×œ</option>
        <option>×‘×™× ×•× ×™</option>
        <option>×× ×•×¡×”</option>
    </select><br><br>

    <button type="submit">×—×©×‘ ×”×§×¦××”</button>
</form>

{% if result %}
<hr>

<h3>ğŸ“Š ×”×§×¦××ª × ×›×¡×™× â€“ ×”×©×•×•××”</h3>

<div class="charts-row">
    <div class="chart-box">
        <canvas id="baseChart"></canvas>
        <p>×”×§×¦××” ×‘×¡×™×¡×™×ª</p>
    </div>

    <div class="chart-box">
        <canvas id="consChart"></canvas>
        <p>××¡×œ×•×œ ×©××¨× ×™</p>
    </div>

    <div class="chart-box">
        <canvas id="aggrChart"></canvas>
        <p>××¡×œ×•×œ ××’×¨×¡×™×‘×™</p>
    </div>
</div>

<script>
    function drawChart(canvasId, dataObj, title) {
        const ctx = document.getElementById(canvasId);
        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: Object.keys(dataObj),
                datasets: [{
                    data: Object.values(dataObj)
                }]
            },
            options: {
                plugins: {
                    legend: { position: 'bottom' },
                    title: { display: false }
                }
            }
        });
    }

    drawChart("baseChart", {{ result.allocation | tojson }});
    drawChart("consChart", {{ result.conservative | tojson }});
    drawChart("aggrChart", {{ result.aggressive | tojson }});
</script>

<hr>

<form method="post">
    {% for k, v in profile.items() %}
        <input type="hidden" name="{{ k }}" value="{{ v }}">
    {% endfor %}
    <button name="whatif" value="down">â¬‡ï¸ ×”×§×˜×Ÿ ×¡×™×›×•×Ÿ</button>
    <button name="whatif" value="up">â¬†ï¸ ×”×’×“×œ ×¡×™×›×•×Ÿ</button>
</form>

{% if whatif %}
<h3>ğŸ”„ What-If (×©×™× ×•×™ ×¡×™×›×•×Ÿ)</h3>
<ul>
{% for k, v in whatif.items() %}
    <li>{{ k }} â€“ {{ v }} ×©"×—</li>
{% endfor %}
</ul>
{% endif %}

{% endif %}

</body>
</html>
